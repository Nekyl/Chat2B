<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat 2B</title>
    <link rel="manifest" href="manifest.json">
    <!-- Links atualizados para os arquivos CSS locais -->
    <link rel="stylesheet" href="local_assets/css/all.min.css">
    <link rel="stylesheet" href="style.css" type="text/css" media="all" />
    <!-- Highlight.js CSS (tema escuro) local -->
    <link rel="stylesheet" href="local_assets/css/dracula.min.css">
    </head>
<body>
    <div class="sidebar" id="sidebar">
        <button class="new-chat-btn">
            <i class="fas fa-plus"></i>
            <span>Nova Conversa</span>
        </button>
        <div class="search-container">
            <button id="search-btn" class="search-btn" title="Buscar nas conversas">
                <i class="fas fa-search"></i>
            </button>
        </div>
        <div class="chat-history"></div>
    </div>
    <div class="overlay" id="sidebar-overlay"></div>

    <div class="main-content">
        <div class="top-bar">
            <button id="mobile-menu-btn" class="mobile-menu-btn top-bar-action-btn" title="Menu">
                <i class="fas fa-bars"></i>
            </button>
            <input type="text" id="api-source-input" class="server-url-input" placeholder="URL Ollama ou 'gemini'" value="Gemini">
            <select id="model-select" class="model-selector">
                <option value="gemini-2.5-flash">Carregando modelos...</option>
            </select>
            <button id="install-pwa-btn" class="top-bar-action-btn" title="Instalar Aplicativo" style="display: none;">
                <i class="fas fa-download"></i>
            </button>
            <button id="app-settings-btn" class="top-bar-action-btn" title="Configurações">
                <i class="fas fa-cog"></i>
            </button>
        </div>

        <div class="chat-container">
            <div class="scroll-container">
                <div class="messages" id="messages">
                    <div class="welcome-screen">
                        <h2>Chat 2B</h2>
                        <p>Como posso ajudar você hoje?</p>
                    </div>
                </div>
                <div id="typing-animation" class="message bot-message">
                    <div class="typing-container">
                        <div class="typing-dots">
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="bottom-bar">
            <div class="input-area-container">
                <div id="image-preview-container">
                    <img id="image-preview" src="#" alt="Image preview"/>
                    <button id="remove-image-btn" title="Remover imagem">&times;</button>
                </div>
                <form id="chat-form" class="input-wrapper" onsubmit="event.preventDefault();">
                    <div class="input-area">
                        <textarea 
                            id="message-input" 
                            placeholder=""
                            rows="1"
                        ></textarea>
                    </div>
                    <div class="input-actions">
                        <input type="file" id="image-file-input" accept="image/*" style="display: none;">
                        <button type="button" id="attach-image-btn" class="attach-btn" title="Anexar imagem">
                            <i class="fas fa-paperclip"></i>
                        </button>
                        <button type="submit" id="send-button" class="send-btn" disabled>
                            <i class="fas fa-arrow-up"></i>
                        </button>
                    </div>
                </form>
            </div>
        </div>
        
    </div>

    <!-- Modal de Confirmação de Exclusão -->
    <div id="delete-confirm-overlay" class="modal-overlay">
        <div id="delete-confirm-modal" class="modal">
            <h2><i class="fas fa-exclamation-triangle"></i> Confirmar Exclusão</h2>
            <p>Você tem certeza absoluta que quer excluir a conversa "<strong id="confirm-delete-chat-title"></strong>"?</p>
            <p class="warning-text">Essa ação não pode ser desfeita!</p>
            <div class="modal-actions">
                <button id="cancel-delete-btn" class="btn btn-secondary">
                    <i class="fas fa-times"></i> Cancelar
                </button>
                <button id="confirm-delete-btn" class="btn btn-danger">
                    <i class="fas fa-trash-alt"></i> Excluir Permanentemente
                </button>
            </div>
        </div>
    </div>
    <!-- Fim do Modal de Exclusão -->

    <!-- Overlay de pesquisa -->
    <div id="search-overlay" class="search-overlay">
        <div class="search-modal">
            <div class="search-header">
                <div class="search-input-container">
                    <i class="fas fa-search"></i>
                    <input type="text" id="search-input" placeholder="Buscar em chats..." />
                    <button id="clear-search" class="clear-search-btn">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <button id="close-search" class="close-search-btn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="search-results" class="search-results">
                <!-- Resultados da busca serão inseridos aqui -->
            </div>
        </div>
    </div>
    <!-- Fim do Overlay de Pesquisa -->

    <!-- Modal de Configurações de 2B -->
    <div id="app-settings-modal-overlay" class="modal-overlay">
        <div id="app-settings-modal" class="modal">
            <h2 style="color: white;"><i class="fas fa-cogs"></i> Configurações de 2B</h2>
            <div class="app-settings-content">

                <div id="api-key-setup-guide" style="display: none; background: rgba(0,0,0,0.2); padding: 15px; border-radius: 8px; margin-bottom: 20px; text-align: left;">
                    <h4 style="margin-top: 0; color: white;"><i class="fas fa-magic"></i> Bem-vindo(a) ao Chat 2B!</h4>
                    <p style="font-size: 0.9em; margin-bottom: 15px;">Para usar a inteligência do Gemini, é necessária uma chave de API do Google AI. É um processo rápido e gratuito.</p>
                    <div class="modal-actions" style="justify-content: center; padding: 0;">
                        <button id="guide-have-key-btn" class="btn btn-secondary">
                            <i class="fas fa-key"></i> Já tenho uma chave
                        </button>
                        <a href="https://aistudio.google.com/apikey" target="_blank" rel="noopener noreferrer" id="guide-create-key-btn" class="btn btn-primary">
                            <i class="fas fa-external-link-alt"></i> Criar chave (grátis)
                        </a>
                    </div>
                </div>

                <div class="setting-item">
                    <label for="system-prompt-input">Prompt do Sistema:</label>
                    <textarea id="system-prompt-input" rows="8"></textarea>
                </div>
                <div class="setting-item setting-item-inline">
                    <label for="temperature-input">Temperatura:</label>
                    <input type="range" id="temperature-input" min="0" max="2" step="0.1"
style="
  -webkit-appearance: none;
  width: 100px;
  height: 6px;
  background: black;
  border-radius: 5px;
  outline: none;
">
<style>
  input[type=range]::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 14px;
    height: 14px;
    background: white;
    border-radius: 50%;
    cursor: pointer;
    border: 2px solid black;
  }
</style>
                    <span id="temperature-value-display" style="margin-left: 5px; color: var(--text-light); font-size: 0.9em;"></span>
                </div>
                <div class="setting-item">
                    <label for="gemini-api-key-input">Chave de API (Google AI):</label>
                    <div class="api-key-input-container">
                        <input type="password" id="gemini-api-key-input" placeholder="Cole sua chave aqui...">
                        <span id="gemini-api-key-display"></span>
                        <button id="api-key-toggle-btn" title="Mostrar/Ocultar chave">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                    <small class="api-key-helper-text">
                        Caso não tenha uma, crie a sua 
                        <a href="https://aistudio.google.com/apikey" target="_blank" rel="noopener noreferrer">aqui</a>.
                    </small>
                </div>
                 <!-- Espaço para feedback -->
                 <div id="settings-feedback" style="margin-top: 10px; color: #4CAF50; font-size: 0.9em; text-align: center;"></div>
            </div>
            <div class="modal-actions">
                <button id="cancel-app-settings-btn" class="btn btn-secondary">
                    <i class="fas fa-times"></i> Cancelar
                </button>
                <button id="save-app-settings-btn" class="btn btn-primary">
                    <i class="fas fa-save"></i> Salvar 
                </button>
            </div>
        </div>
    </div>
    <!-- Fim do Modal de Configurações -->

    <!-- Scripts atualizados para os arquivos JS locais -->
    <script src="local_assets/js/marked.min.js"></script>
    <script src="local_assets/js/highlight.min.js"></script>
    
    <!-- Inicializa highlight.js -->
    <script>hljs.highlightAll();</script>
    <script>
        const textarea = document.getElementById('message-input');
        
        textarea.addEventListener('input', () => {
            textarea.style.height = 'auto'; // reseta antes de medir
            textarea.style.height = Math.min(textarea.scrollHeight, 150) + 'px';
        });
        </script>
    <script type="module" src="script.js"></script>
</body>
<div id="connection-status-toast" class="connection-toast hidden">
    <i class="fas fa-wifi"></i>
    <span id="connection-status-text"></span>
</div>
</html>
